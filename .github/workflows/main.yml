jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Build Docker Image
        run: |
          docker build -t skip-parser ./Skip\ Tracing

      - name: Run Script Inside Container
        env:
          TWO_CAPTCHA_API_KEY: ${{ secrets.TWO_CAPTCHA_API_KEY }}
          VPN_USERNAME: ${{ secrets.VPN_USERNAME }}
          VPN_PASSWORD: ${{ secrets.VPN_PASSWORD }}
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
          GOOGLE_TOKEN_JSON: ${{ secrets.GOOGLE_TOKEN_JSON }}
        run: |
          docker run --rm -e TWO_CAPTCHA_API_KEY -e VPN_USERNAME -e VPN_PASSWORD \
            -e GOOGLE_CREDENTIALS_JSON -e GOOGLE_TOKEN_JSON \
            skip-parser python truppl_parser.py
