# Use slim Python image for smaller footprint
FROM python:3.11-slim

# Set environment variables to ensure UTF-8 encoding and avoid interactive prompts
ENV PYTHONUNBUFFERED=1 \
    PYTHONIOENCODING=utf-8 \
    DEBIAN_FRONTEND=noninteractive

# Install system dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        curl \
        unzip \
        wget \
        gnupg \
        build-essential \
        libffi-dev \
        libssl-dev \
        libnss3 \
        libatk-bridge2.0-0 \
        libx11-xcb1 \
        libxcomposite1 \
        libxcursor1 \
        libxdamage1 \
        libxi6 \
        libxtst6 \
        libxrandr2 \
        libasound2 \
        libpangocairo-1.0-0 \
        libatk1.0-0 \
        libgtk-3-0 \
        libdrm2 \
        xauth \
        xvfb \
        ca-certificates \
        npm \
        git \
        iproute2 \
        openvpn \
        dnsutils \
        iputils-ping \
        net-tools && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Upgrade pip and install Python dependencies
COPY requirements.txt /tmp/requirements.txt
COPY pip-requirements.txt /tmp/pip-requirements.txt
RUN pip install --upgrade pip && \
    pip install -r /tmp/requirements.txt && \
    pip install -r /tmp/pip-requirements.txt && \
    pip install beautifulsoup4 google-api-python-client google-auth-oauthlib python-dotenv

# Install Playwright and its browsers
RUN npm install -g playwright && \
    playwright install --with-deps && \
    playwright install chromium

# Copy VPN configuration files
COPY externals/VPNs /app/externals/VPNs

# Copy Skip Tracing script directory (handle space in name)
COPY Skip\ Tracing /app/Skip\ Tracing

# Set working directory to script location
WORKDIR /app/Skip Tracing

# Default command to run your script
CMD ["python", "truppl_parser.py"]
